(window["webpackJsonpfile-upload-search"]=window["webpackJsonpfile-upload-search"]||[]).push([[0],{47:function(e,t){},492:function(e,t,a){},495:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(32),c=a.n(l),s=(a(93),a(94),a(39)),o=a(18),i=a(8),m=a.n(i),u=a(14),p=a(33),d=a(24),f=a(25),h=a(27),E=a(26),b=a(28),v=a(496),g=a(497),y=a(13);function N(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function O(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?N(a,!0).forEach((function(t){Object(p.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):N(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var w=a(96),j=a(468),k="omc-dms-file-details";w.config.setPromisesDependency(j),w.config.update({region:"ap-south-1",credentials:new w.CognitoIdentityCredentials({IdentityPoolId:"ap-south-1:50c0cd12-acd7-4fc3-b8eb-3466d716dff1"})});var x=new w.S3({apiVersion:"2006-03-01",params:{Bucket:"omc-dms-files"}}),D=new w.DynamoDB.DocumentClient;function S(e,t){var a={Key:e+"."+t.name.split(".").pop(),Body:t,ContentType:t.type};return x.upload(a)}function F(e){var t={TableName:k,Item:O({},e,{dayTimestamp:(new Date).setHours(0,0,0,0)})};return D.put(t).promise()}function C(e,t){return P.apply(this,arguments)}function P(){return(P=Object(u.a)(m.a.mark((function e(t,a){var n,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof a&&(a=a.toLowerCase()),"name"!==t){e.next=8;break}return n={TableName:k,FilterExpression:"contains (#key, :value)",ExpressionAttributeNames:{"#key":"searchName"},ExpressionAttributeValues:{":value":a}},e.next=5,U(n);case 5:r=e.sent,e.next=21;break;case 8:if("description"!==t){e.next=15;break}return n={TableName:k,FilterExpression:"contains (#key, :value)",ExpressionAttributeNames:{"#key":"searchDescription"},ExpressionAttributeValues:{":value":a}},e.next=12,U(n);case 12:r=e.sent,e.next=21;break;case 15:if("dateRange"!==t){e.next=21;break}return n={TableName:k,FilterExpression:"#key BETWEEN :start and :end",ExpressionAttributeNames:{"#key":"dayTimestamp"},ExpressionAttributeValues:{":start":Date.parse(a.start),":end":Date.parse(a.end)}},e.next=20,U(n);case 20:r=e.sent;case 21:return e.abrupt("return",V(r));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=function(){var e=Object(u.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D.scan(t).promise();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),V=function(){var e=Object(u.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",t.Items.map((function(e){return O({},e,{fileName:e.s3FileKey,fileUrl:x.getSignedUrl("getObject",{Bucket:"omc-dms-files",Key:e.s3FileKey,Expires:600})})})));case 4:return e.prev=4,e.t0=e.catch(0),e.abrupt("return",null);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(t){return e.apply(this,arguments)}}(),I=function(e){var t=e.formErrors;return r.a.createElement("div",{className:"formErrors"},Object.keys(t).map((function(e,a){return t[e].length>0?r.a.createElement("p",{key:a},t[e]):""})))};function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function M(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?R(a,!0).forEach((function(t){Object(p.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):R(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var T=function(e){function t(e){var a;return Object(d.a)(this,t),(a=Object(h.a)(this,Object(E.a)(t).call(this,e))).handleUserInput=function(e){e.preventDefault();var t=e.target,n=t.name,r=t.value,l=a.state.formErrors,c=a.state,s=c.isNamevalid,o=c.isDescriptionValid,i=c.isFileValid;switch(n){case"name":s=r.length>0,l.name=s?"":"Name cannot be empty!";break;case"description":o=r.length>0,l.description=o?"":"Description cannot be empty!";break;case"file":i=e.target.files[0]instanceof File,r=e.target.files[0],l.file=i?"":"Please upload the file"}a.setState(Object(p.a)({formErrors:l,isNamevalid:s,isDescriptionValid:o,isFileValid:i},n,r),(function(){a.validateForm()}))},a.onSubmitHandler=function(){var e=Object(u.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.preventDefault();try{S(a.state.name,a.state.file).on("httpUploadProgress",(function(e){a.setState({uploaded:e.loaded/e.total*100})})).send(function(){var e=Object(u.a)(m.a.mark((function e(t,n){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return a.handleUploadErrors(t),e.abrupt("return");case 3:if("Key"in n){e.next=6;break}return a.handleUploadErrors(t),e.abrupt("return");case 6:return r={name:a.state.name,searchName:a.state.name.toLowerCase(),description:a.state.description,searchDescription:a.state.description.toLowerCase(),s3FileKey:n.Key},e.next=9,F(r).then((function(e){y.b.success("Upload success"),window.setTimeout((function(){document.getElementById("fileInput")&&(document.getElementById("fileInput").value=""),a.setState(M({},a.initialState))}),5e3)})).catch((function(e){a.handleUploadErrors(e)}));case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())}catch(n){a.handleUploadErrors(n)}case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleUploadErrors=function(e){console.log("string"==typeof e?e:JSON.stringify(e,2)),y.b.error("Upload failure")},a.state=a.initialState={name:"",description:"",file:"",formErrors:{name:"",description:"",file:""},isNamevalid:!1,isDescriptionValid:!1,isFileValid:!1,isFormValid:!1,uploaded:0},a}return Object(b.a)(t,e),Object(f.a)(t,[{key:"validateForm",value:function(){this.setState({isFormValid:this.state.isNamevalid&&this.state.isDescriptionValid&&this.state.isFileValid})}},{key:"errorClass",value:function(e){return 0===e.length?"":"has-error"}},{key:"render",value:function(){return r.a.createElement("div",{className:"container"},r.a.createElement("h3",null,"Upload your Documents"),r.a.createElement("br",null),r.a.createElement("form",null,r.a.createElement("div",{className:"form-group row ".concat(this.errorClass(this.state.formErrors.name))},r.a.createElement("label",{htmlFor:"name",className:"col-sm-2 col-form-label"},"Name"),r.a.createElement("div",{className:"col-sm-6 col-md-4"},r.a.createElement("input",{type:"text",className:"form-control",id:"name",name:"name",placeholder:"Name",value:this.state.name,onChange:this.handleUserInput}))),r.a.createElement("div",{className:"form-group row ".concat(this.errorClass(this.state.formErrors.description))},r.a.createElement("label",{htmlFor:"description",className:"col-sm-2 col-form-label"},"Description"),r.a.createElement("div",{className:"col-sm-6 col-md-4"},r.a.createElement("textarea",{type:"text",className:"form-control",id:"description",placeholder:"Description",name:"description",value:this.state.description,onChange:this.handleUserInput}))),r.a.createElement("div",{className:"form-group row ".concat(this.errorClass(this.state.formErrors.file))},r.a.createElement("label",{className:"col-sm-2 col-form-label"},"Upload your file"),r.a.createElement("div",{className:"col-sm-6 col-md-4"},r.a.createElement("div",{className:"files"},r.a.createElement("input",{type:"file",name:"file",onChange:this.handleUserInput,id:"fileInput"})))),r.a.createElement("div",{className:"panel panel-default"},r.a.createElement(I,{formErrors:this.state.formErrors})),r.a.createElement("div",{className:"form-group"},r.a.createElement(y.a,null),r.a.createElement(v.a,{max:"100",color:"success",value:this.state.uploaded},Math.round(this.state.uploaded,2),"%")),r.a.createElement(g.a,{color:"success",disabled:!this.state.isFormValid||0!==this.state.uploaded,onClick:this.onSubmitHandler},"Upload")))}}]),t}(n.Component),B=a(15),A=a(498),Y=function(e){var t=e.fetchedFiles;return r.a.createElement("div",null,r.a.createElement("h3",null,"Results"),r.a.createElement(A.a,{striped:!0,bordered:!0,hover:!0},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Name"),r.a.createElement("th",null,"Description"),r.a.createElement("th",null,"View"))),r.a.createElement("tbody",null,t.length>0&&t.map((function(e,t){return r.a.createElement("tr",{key:t},r.a.createElement("td",null,e.name),r.a.createElement("td",null,e.description),r.a.createElement("td",null," ",r.a.createElement("a",{href:e.fileUrl,target:"_blank",rel:"noopener noreferrer"},r.a.createElement(g.a,null,r.a.createElement(B.c,null)))))})),0===t.length&&r.a.createElement("tr",null,r.a.createElement("td",{colSpan:"3"},"No results")))))},K=a(85),J=a.n(K),L=(a(490),function(e){function t(){var e,a;Object(d.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(h.a)(this,(e=Object(E.a)(t)).call.apply(e,[this].concat(r)))).state={isOpen:!1},a.onToggle=function(){a.setState({isOpen:!a.state.isOpen})},a}return Object(b.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this,t="".concat(this.props.dateRange.start.format("MMMM D, YYYY")," - ").concat(this.props.dateRange.end.format("MMMM D, YYYY"));return r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label"},"Date Range"),r.a.createElement("div",{className:"col-sm-6 col-md-4"},r.a.createElement("div",{className:"input-group add-on"},r.a.createElement("input",{className:"form-control",value:t,readOnly:!0}),r.a.createElement("div",{className:"input-group-btn"},r.a.createElement(g.a,{onClick:this.onToggle},!this.state.isOpen&&r.a.createElement(B.a,null),this.state.isOpen&&r.a.createElement(B.b,null))),this.state.isOpen&&r.a.createElement(J.a,{value:this.props.dateRange,onSelect:this.props.onSelect,singleDateRange:!0}))),r.a.createElement(g.a,{className:"col-sm-1 btn-fit",onClick:function(){return e.props.handleSearch("dateRange")}},r.a.createElement(B.d,null)))}}]),t}(r.a.Component)),H=a(37),W=a.n(H),$=a(51),_=Object($.extendMoment)(W.a),q=function(e){function t(e){var a;Object(d.a)(this,t),(a=Object(h.a)(this,Object(E.a)(t).call(this,e))).onSelectDP=function(e,t){a.setState({dateRange:e,states:t})},a.handleSearch=function(){var e=Object(u.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.setState({fetchedFiles:[]}),"dateRange"===t){e.next=5;break}if(""!==a.state[t]&&""!==a.state[t].trim()){e.next=5;break}return y.b.error("".concat(t.charAt(0).toUpperCase()+t.slice(1)," cannot be empty!")),e.abrupt("return");case 5:return e.prev=5,e.next=8,C(t,a.state[t]);case 8:n=e.sent,a.setState({fetchedFiles:n}),n.length>0?y.b.success("Fetching success"):y.b.error("Sorry! No Documents found"),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(5),y.b.error("Fetching failure"+JSON.stringify(e.t0,2));case 16:case"end":return e.stop()}}),e,null,[[5,13]])})));return function(t){return e.apply(this,arguments)}}();var n=_();return a.state={name:"",description:"",fetchedFiles:[],dateRange:_.range(n.clone().subtract(2,"days"),n.clone())},a}return Object(b.a)(t,e),Object(f.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"container"},r.a.createElement("h3",null,"Search your Documents by: "),r.a.createElement("br",null),r.a.createElement("form",{className:"searchFileForm"},r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label"},"Name"),r.a.createElement("div",{className:"col-sm-6 col-md-4"},r.a.createElement("input",{type:"text",className:"form-control",id:"name",placeholder:"Name",onChange:function(t){return e.setState({name:t.target.value})}})),r.a.createElement(g.a,{className:"col-sm-1 btn-fit",onClick:function(){return e.handleSearch("name")}},r.a.createElement(B.d,null))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-4 offset-md-4"},"--------OR---------")),r.a.createElement("br",null),r.a.createElement("div",{className:"form-group row"},r.a.createElement("label",{className:"col-sm-2 col-form-label"},"Description"),r.a.createElement("div",{className:"col-sm-6 col-md-4"},r.a.createElement("input",{type:"description",className:"form-control",id:"description",placeholder:"Description",onChange:function(t){return e.setState({description:t.target.value})}})),r.a.createElement(g.a,{className:"col-sm-1 btn-fit",onClick:function(){return e.handleSearch("description")}},r.a.createElement(B.d,null))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md-4 offset-md-4"},"--------OR---------")),r.a.createElement("br",null),r.a.createElement(L,Object.assign({},this.state,{onSelect:function(t){return e.setState({dateRange:t})},handleSearch:function(){return e.handleSearch("dateRange")}}))),r.a.createElement(Y,{fetchedFiles:this.state.fetchedFiles}),r.a.createElement(y.a,null))}}]),t}(n.Component);a(491),a(492);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement((function(){return r.a.createElement("div",null,r.a.createElement("div",{className:"d-flex justify-content-center margin-header"},r.a.createElement("img",{className:"omc-logo",src:"https://omcltd.in/Portals/0/logo.png",alt:"OMC Logo"}),r.a.createElement("h1",null,"Document management System")),r.a.createElement(s.a,null,r.a.createElement("div",null,r.a.createElement("div",{className:"margin-all route-buttons"},r.a.createElement("div",{className:"d-flex justify-content-around"},r.a.createElement("div",{className:"p-2 text-center"},r.a.createElement(s.b,{to:"/uploadFile"},r.a.createElement(g.a,{outline:!0,color:"info"},"Upload Document"))),r.a.createElement("div",{className:"p-2 text-center"},r.a.createElement(s.b,{to:"/searchFile"},r.a.createElement(g.a,{outline:!0,color:"info"},"Search Document"))))),r.a.createElement(o.a,{path:"/uploadFile",component:T}),r.a.createElement(o.a,{path:"/searchFile",component:q}))))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},88:function(e,t,a){e.exports=a(495)},93:function(e,t,a){}},[[88,1,2]]]);
//# sourceMappingURL=main.7e165a5c.chunk.js.map